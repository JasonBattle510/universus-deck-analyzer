<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universus Deck Analyzer - AI Powered</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0a; color: #f9fafb; min-height: 100vh; }
        .app { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }
        .header { background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border: 1px solid #404040; borderRadius: 16px; padding: 2.5rem; marginBottom: 2rem; boxShadow: 0 10px 40px rgba(0, 0, 0, 0.5); }
        .title { fontSize: 2.5rem; fontWeight: 700; marginBottom: 0.5rem; color: #ffffff; letterSpacing: -0.02em; }
        .subtitle { color: #d1d5db; fontSize: 1.125rem; fontWeight: 500; }
        .status { color: #93c5fd; fontSize: 0.875rem; marginTop: 0.75rem; fontWeight: 500; }
        .tabs { display: flex; gap: 0.75rem; marginBottom: 2rem; flexWrap: wrap; }
        .tab { padding: 0.875rem 1.75rem; borderRadius: 10px; fontWeight: 600; cursor: pointer; transition: all 0.2s; border: none; fontSize: 1rem; }
        .tab-active { background: #f9fafb; color: #0a0a0a; boxShadow: 0 4px 12px rgba(249, 250, 251, 0.3); }
        .tab-inactive { background: #1a1a1a; color: #9ca3af; border: 1px solid #404040; }
        .tab-inactive:hover { background: #2d2d2d; color: #d1d5db; }
        .card { background: #1a1a1a; border: 1px solid #404040; borderRadius: 12px; padding: 2rem; boxShadow: 0 4px 20px rgba(0, 0, 0, 0.3); }
        .btn { width: 100%; padding: 1rem; borderRadius: 10px; fontWeight: 600; fontSize: 1rem; cursor: pointer; border: none; transition: all 0.2s; marginTop: 0.75rem; }
        .btn-primary { background: #f9fafb; color: #0a0a0a; }
        .btn-primary:hover { background: #ffffff; transform: translateY(-1px); }
        .btn-primary:disabled { background: #404040; color: #6b7280; cursor: not-allowed; }
        .btn-secondary { background: #2d2d2d; color: #d1d5db; }
        .btn-secondary:hover { background: #404040; }
        .btn-success { background: #93c5fd; color: #0a0a0a; }
        .btn-success:hover { background: #bfdbfe; }
        .alert { padding: 1rem; borderRadius: 8px; marginBottom: 1.5rem; borderLeft: 4px solid; }
        .alert-warning { background: #1a1a1a; borderColor: #93c5fd; color: #dbeafe; }
        .alert-info { background: #1a1a1a; borderColor: #93c5fd; color: #dbeafe; }
        .alert-success { background: #1a1a1a; borderColor: #93c5fd; color: #dbeafe; }
        .progress-box { background: #1a1a1a; border: 1px solid #404040; borderRadius: 8px; padding: 1rem; marginBottom: 1rem; }
        .progress-bar { width: 100%; height: 8px; background: #0a0a0a; borderRadius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #93c5fd, #dbeafe); transition: width 0.3s; }
        .smart-box { background: #1a1a1a; border: 2px solid #93c5fd; borderRadius: 8px; padding: 1rem; marginBottom: 1.5rem; }
        .input, .textarea { width: 100%; background: #0a0a0a; border: 1px solid #404040; borderRadius: 8px; padding: 0.875rem; color: #f9fafb; fontSize: 0.95rem; }
        .input:focus, .textarea:focus { outline: none; borderColor: #93c5fd; boxShadow: 0 0 0 3px rgba(147, 197, 253, 0.1); }
        .textarea { fontFamily: 'Courier New', monospace; resize: vertical; minHeight: 250px; }
        .spinner { border: 3px solid #404040; borderTopColor: transparent; borderRadius: 50%; width: 1.5rem; height: 1.5rem; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .api-key-section { background: #0a0a0a; border: 2px solid #93c5fd; borderRadius: 12px; padding: 1.5rem; marginBottom: 2rem; }
        
        /* Analysis Styling - Clean Monochrome */
        .analysis { 
            background: #0a0a0a; 
            border-radius: 12px; 
            padding: 2.5rem; 
            font-size: 0.95rem; 
            line-height: 1.8; 
            color: #d1d5db;
            font-weight: 400;
        }
        .analysis h1 { 
            display: block;
            color: #f9fafb; 
            font-size: 1.875rem; 
            margin-top: 2.5rem; 
            margin-bottom: 1.25rem; 
            font-weight: 700;
            letter-spacing: -0.025em;
            border-bottom: 2px solid #404040;
            padding-bottom: 0.75rem;
        }
        .analysis h1:first-child { margin-top: 0; }
        .analysis h2 { 
            display: block;
            color: #f9fafb; 
            font-size: 1.5rem; 
            margin-top: 2.25rem; 
            margin-bottom: 1.25rem; 
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        .analysis h3 { 
            display: block;
            color: #dbeafe; 
            font-size: 1.25rem; 
            margin-top: 1.75rem; 
            margin-bottom: 1rem; 
            font-weight: 600;
        }
        .analysis h4 {
            display: block;
            color: #93c5fd;
            font-size: 1.05rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        .analysis p { 
            display: block;
            margin-bottom: 1.25rem; 
            line-height: 1.8;
        }
        .analysis ul, .analysis ol { 
            display: block;
            margin-left: 1.75rem; 
            margin-bottom: 1.5rem;
            margin-top: 0.75rem;
        }
        .analysis li { 
            display: list-item;
            margin-bottom: 0.75rem;
            padding-left: 0.5rem;
            line-height: 1.7;
        }
        .analysis ul ul, .analysis ol ol,
        .analysis ul ol, .analysis ol ul {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            margin-left: 1.5rem;
        }
        .analysis li > p {
            margin-bottom: 0.5rem;
        }
        .analysis strong, .analysis b { 
            color: #f9fafb; 
            font-weight: 600;
        }
        .analysis em, .analysis i {
            color: #dbeafe;
            font-style: italic;
        }
        .analysis code { 
            background: #1a1a1a; 
            padding: 0.25rem 0.5rem; 
            border-radius: 4px; 
            font-family: 'Courier New', monospace; 
            font-size: 0.875rem; 
            color: #93c5fd;
            border: 1px solid #404040;
        }
        .analysis pre { 
            display: block;
            background: #1a1a1a; 
            padding: 1.25rem; 
            border-radius: 8px; 
            overflow: auto; 
            margin-bottom: 1.5rem;
            border: 1px solid #404040;
        }
        .analysis pre code { 
            background: none; 
            padding: 0;
            border: none;
            color: #dbeafe;
        }
        .analysis blockquote { 
            display: block;
            border-left: 4px solid #93c5fd; 
            padding-left: 1.25rem; 
            margin-left: 0; 
            margin-bottom: 1.5rem; 
            color: #9ca3af; 
            font-style: italic;
        }
        .analysis hr { 
            display: block;
            border: none; 
            border-top: 2px solid #404040; 
            margin: 2.5rem 0;
        }
        .analysis a {
            color: #93c5fd;
            text-decoration: underline;
        }
        .analysis a:hover {
            color: #bfdbfe;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const GITHUB_BASE = 'https://cdn.jsdelivr.net/gh/JasonBattle510/universus-deck-analyzer@main/UVS_Dataset-main';
        const WORKER_URL = 'https://red-dew-4e75.slothcedric.workers.dev';
        
        // Configure marked.js for better rendering
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: false,
            mangle: false
        });
        
        function App() {
            const [activeTab, setActiveTab] = useState('analyze');
            const [decks, setDecks] = useState([]);
            const [selectedDeck, setSelectedDeck] = useState(null);
            const [deckInput, setDeckInput] = useState('');
            const [deckName, setDeckName] = useState('');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [error, setError] = useState('');
            const [cardDatabase, setCardDatabase] = useState({});
            const [loadedSets, setLoadedSets] = useState([]);
            const [isLoadingSets, setIsLoadingSets] = useState(false);
            const [availableSets, setAvailableSets] = useState([]);
            const [selectedSets, setSelectedSets] = useState([]);
            const [suggestedSets, setSuggestedSets] = useState([]);
            const [isDetecting, setIsDetecting] = useState(false);
            const [detectProgress, setDetectProgress] = useState({ current: 0, total: 0 });
            const [apiKey, setApiKey] = useState('');
            const [apiKeyInput, setApiKeyInput] = useState('');
            
            useEffect(() => {
                const stored = localStorage.getItem('universus-decks-v3');
                if (stored) {
                    try {
                        const data = JSON.parse(stored);
                        setDecks(data.decks || []);
                        setLoadedSets(data.loadedSets || []);
                    } catch (e) { console.error(e); }
                }
                const storedKey = localStorage.getItem('anthropic-api-key');
                if (storedKey) {
                    setApiKey(storedKey);
                    setApiKeyInput(storedKey);
                }
                loadSetList();
            }, []);
            
            useEffect(() => {
                if (decks.length > 0) {
                    const lightDecks = decks.map(d => ({
                        id: d.id,
                        name: d.name,
                        deckList: d.deckList,
                        analysis: d.analysis,
                        createdAt: d.createdAt
                    }));
                    localStorage.setItem('universus-decks-v3', JSON.stringify({ decks: lightDecks, loadedSets }));
                }
            }, [decks, loadedSets]);
            
            const saveApiKey = () => {
                localStorage.setItem('anthropic-api-key', apiKeyInput);
                setApiKey(apiKeyInput);
                alert('API key saved!');
            };
            
            const clearApiKey = () => {
                if (confirm('Remove your API key?')) {
                    localStorage.removeItem('anthropic-api-key');
                    setApiKey('');
                    setApiKeyInput('');
                }
            };
            
            const loadSetList = async () => {
                try {
                    const response = await fetch(`${GITHUB_BASE}/setList.json`);
                    if (response.ok) {
                        const data = await response.json();
                        setAvailableSets(data.sets || []);
                        setSelectedSets(data.sets?.map(s => s.id) || []);
                    }
                } catch (e) { console.error(e); }
            };
            
            const detectNeededSets = async () => {
                if (!deckInput.trim()) { setError('Enter deck list first'); return; }
                setIsDetecting(true);
                setSuggestedSets([]);
                setDetectProgress({ current: 0, total: availableSets.length });
                
                const cardNames = deckInput.split('\n')
                    .map(line => line.trim())
                    .filter(line => line && !line.startsWith('['))
                    .map(line => {
                        const match = line.match(/^\d+\s+(.+)$/);
                        return match ? match[1].trim().toLowerCase() : '';
                    })
                    .filter(Boolean);
                
                const neededSets = new Set();
                for (let i = 0; i < availableSets.length; i++) {
                    const set = availableSets[i];
                    setDetectProgress({ current: i + 1, total: availableSets.length });
                    try {
                        const response = await fetch(`${GITHUB_BASE}/${set.id}/setData.json`);
                        if (!response.ok) continue;
                        const data = await response.json();
                        const setCardNames = Object.values(data.Cards).map(card => card.Name.toLowerCase());
                        if (cardNames.some(name => setCardNames.includes(name))) {
                            neededSets.add(set.id);
                        }
                    } catch (err) { console.error(`Failed: ${set.id}`, err); }
                }
                setSuggestedSets(Array.from(neededSets));
                setSelectedSets(Array.from(neededSets));
                setIsDetecting(false);
                setDetectProgress({ current: 0, total: 0 });
            };
            
            const loadSets = async () => {
                setIsLoadingSets(true);
                setError('');
                const newDatabase = {};
                const successful = [];
                for (const setId of selectedSets) {
                    try {
                        const url = `${GITHUB_BASE}/${setId}/setData.json`;
                        const response = await fetch(url);
                        if (!response.ok) continue;
                        const data = await response.json();
                        Object.values(data.Cards).forEach(card => {
                            const key = card.Name.toLowerCase().trim();
                            if (!newDatabase[key]) newDatabase[key] = [];
                            newDatabase[key].push({ ...card, setId });
                        });
                        successful.push(setId);
                    } catch (err) { console.error(`Failed: ${setId}`, err); }
                }
                setCardDatabase(newDatabase);
                setLoadedSets(successful);
                setIsLoadingSets(false);
                if (successful.length === 0) setError('Failed to load sets.');
            };
            
            const generateAIAnalysis = async (cards) => {
                if (!apiKey) {
                    return '‚ö†Ô∏è **AI Analysis Unavailable**\n\nPlease add your Anthropic API key in Settings.\n\nGet your key at: https://console.anthropic.com/';
                }
                
                try {
                    const cardDetails = cards.map(c => {
                        if (!c.card) return `${c.count}x ${c.name} (NOT FOUND)`;
                        let detail = `${c.count}x ${c.card.Name} (${c.card.Cardtype})`;
                        if (c.card.Difficulty != null) detail += ` - Diff: ${c.card.Difficulty}, Control: ${c.card.Check}`;
                        if (c.card.Speed != null) detail += ` - Speed: ${c.card.Speed}, Damage: ${c.card.Damage}, Zone: ${c.card.AttackZone}`;
                        if (c.card.BlockZone) detail += ` - Block: ${c.card.BlockZone}+${c.card.BlockMod}`;
                        if (c.card.Keywords?.length) detail += ` - Keywords: ${c.card.Keywords.map(k => k.Name).join(', ')}`;
                        if (c.card.Abilities?.length) {
                            detail += `\n  Abilities:`;
                            c.card.Abilities.forEach(a => detail += `\n  - ${a.Type}${a.Cost ? ` (${a.Cost})` : ''}: ${a.Effect}`);
                        }
                        return detail;
                    }).join('\n\n');

                    const character = cards.find(c => c.card?.Cardtype === 'Character');
                    let charDetails = '';
                    if (character?.card) {
                        const c = character.card;
                        charDetails = `Character: ${c.Name}\nHand Size: ${c.HandSize}, Vitality: ${c.Health}\n`;
                        if (c.Abilities?.length) {
                            charDetails += 'Character Abilities:\n';
                            c.Abilities.forEach(a => charDetails += `- ${a.Type}: ${a.Effect}\n`);
                        }
                    }

                    const prompt = `You are an expert Universus TCG deck analyst. Analyze this deck and provide a DETAILED strategic breakdown.

${charDetails}

FULL DECK LIST:
${cardDetails}

Provide comprehensive analysis covering:
1. **Win Condition** - How does this deck win? Primary kill route with exact damage calculations
2. **Key Combos** - Important card interactions and synergies (be specific with card names)
3. **Gameplay Strategy** - Turn-by-turn gameplay and ideal sequences
4. **Core Engine** - Essential cards and how they work together
5. **Strengths & Weaknesses** - What this deck does well and its vulnerabilities

Be specific with card names, exact numbers, damage calculations, and gameplay sequences.`;

                    const response = await fetch(WORKER_URL, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.content?.find(c => c.type === 'text')?.text || 'Analysis failed';
                } catch (err) {
                    console.error('AI failed:', err);
                    return `‚ö†Ô∏è **AI Analysis Failed**\n\nError: ${err.message}\n\nCheck your API key in Settings.`;
                }
            };
            
            const analyzeDeck = async () => {
                if (!deckInput.trim() || !deckName.trim()) { setError('Enter deck name and list'); return; }
                if (Object.keys(cardDatabase).length === 0) { setError('Load sets first!'); return; }
                setIsAnalyzing(true);
                setError('');
                try {
                    const cards = deckInput.split('\n')
                        .map(line => line.trim())
                        .filter(line => line && !line.startsWith('['))
                        .map(line => {
                            const match = line.match(/^(\d+)\s+(.+)$/);
                            if (match) {
                                const count = parseInt(match[1]);
                                const cardName = match[2].trim();
                                const cardVersions = cardDatabase[cardName.toLowerCase()];
                                return { count, card: cardVersions?.[0], name: cardName };
                            }
                            return null;
                        })
                        .filter(Boolean);
                    
                    const aiAnalysis = await generateAIAnalysis(cards);
                    setDecks([...decks, { id: Date.now(), name: deckName, deckList: deckInput, analysis: aiAnalysis, createdAt: new Date().toISOString() }]);
                    setDeckInput('');
                    setDeckName('');
                    setSuggestedSets([]);
                    setActiveTab('library');
                } catch (err) {
                    setError('Analysis failed: ' + err.message);
                } finally {
                    setIsAnalyzing(false);
                }
            };
            
            return (
                <div className="app">
                    <div className="header">
                        <h1 className="title">Universus Deck Analyzer</h1>
                        <p className="subtitle">AI-Powered Strategic Analysis</p>
                        {loadedSets.length > 0 && <p className="status">‚úÖ {loadedSets.length} sets | {Object.keys(cardDatabase).reduce((s, k) => s + cardDatabase[k].length, 0)} cards loaded</p>}
                        {apiKey && <p className="status">ü§ñ AI Analysis: Enabled</p>}
                    </div>
                    
                    <div className="tabs">
                        <button onClick={() => setActiveTab('analyze')} className={`tab ${activeTab === 'analyze' ? 'tab-active' : 'tab-inactive'}`}>Analyze</button>
                        <button onClick={() => setActiveTab('library')} className={`tab ${activeTab === 'library' ? 'tab-active' : 'tab-inactive'}`}>Library ({decks.length})</button>
                        {selectedDeck && <button onClick={() => setActiveTab('view')} className={`tab ${activeTab === 'view' ? 'tab-active' : 'tab-inactive'}`}>View</button>}
                        <button onClick={() => setActiveTab('settings')} className={`tab ${activeTab === 'settings' ? 'tab-active' : 'tab-inactive'}`}>‚öôÔ∏è Settings</button>
                    </div>
                    
                    {activeTab === 'analyze' && (
                        <div className="card">
                            <h2 style={{fontSize: '1.75rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1.5rem'}}>Analyze Deck</h2>
                            {!apiKey && (
                                <div className="alert alert-info">
                                    üí° Add your Anthropic API key in Settings to enable AI analysis!
                                    <br/><a href="https://console.anthropic.com/" target="_blank" style={{color: '#93c5fd', textDecoration: 'underline'}}>Get API Key ‚Üí</a>
                                </div>
                            )}
                            {Object.keys(cardDatabase).length === 0 && <div className="alert alert-warning">‚ö†Ô∏è No sets loaded. Use "Detect Needed Sets".</div>}
                            {error && <div className="alert alert-warning">{error}</div>}
                            {isDetecting && detectProgress.total > 0 && (
                                <div className="progress-box">
                                    <div style={{color: '#d1d5db', fontSize: '0.875rem', marginBottom: '0.5rem'}}>Scanning... {detectProgress.current}/{detectProgress.total}</div>
                                    <div className="progress-bar"><div className="progress-fill" style={{width: `${(detectProgress.current / detectProgress.total) * 100}%`}}></div></div>
                                </div>
                            )}
                            {suggestedSets.length > 0 && !isDetecting && (
                                <div className="smart-box">
                                    <div style={{color: '#dbeafe', fontWeight: 600, marginBottom: '0.5rem'}}>üéØ Found {suggestedSets.length} sets needed</div>
                                    <div style={{color: '#93c5fd', fontSize: '0.875rem'}}>{suggestedSets.map(id => availableSets.find(s => s.id === id)?.name || id).join(', ')}</div>
                                </div>
                            )}
                            <div style={{marginBottom: '1.5rem'}}>
                                <label style={{display: 'block', fontSize: '0.9rem', fontWeight: 600, marginBottom: '0.5rem', color: '#d1d5db'}}>Deck Name</label>
                                <input className="input" value={deckName} onChange={e => setDeckName(e.target.value)} placeholder="My Deck" />
                            </div>
                            <div style={{marginBottom: '1.5rem'}}>
                                <label style={{display: 'block', fontSize: '0.9rem', fontWeight: 600, marginBottom: '0.5rem', color: '#d1d5db'}}>Deck List</label>
                                <textarea className="textarea" value={deckInput} onChange={e => setDeckInput(e.target.value)} placeholder="1 Character&#10;4 Card Name..." />
                            </div>
                            <button className="btn btn-secondary" onClick={detectNeededSets} disabled={isDetecting || !deckInput.trim()}>
                                {isDetecting ? 'üîç Detecting...' : 'üîç Detect Needed Sets'}
                            </button>
                            {suggestedSets.length > 0 && (
                                <button className="btn btn-primary" onClick={loadSets} disabled={isLoadingSets}>
                                    {isLoadingSets ? 'Loading...' : `Load ${suggestedSets.length} Sets`}
                                </button>
                            )}
                            <button className="btn btn-primary" onClick={analyzeDeck} disabled={isAnalyzing || Object.keys(cardDatabase).length === 0}>
                                {isAnalyzing ? <span>ü§ñ Analyzing... <span className="spinner"></span></span> : 'ü§ñ Analyze with AI'}
                            </button>
                        </div>
                    )}
                    
                    {activeTab === 'library' && (
                        <div className="card">
                            <h2 style={{fontSize: '1.75rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1.5rem'}}>Library</h2>
                            {decks.length === 0 ? (
                                <div style={{textAlign: 'center', padding: '4rem', color: '#6b7280'}}>No decks yet!</div>
                            ) : (
                                <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                    {decks.map(deck => (
                                        <div key={deck.id} onClick={() => { setSelectedDeck(deck); setActiveTab('view'); }} style={{background: '#0a0a0a', border: '1px solid #404040', borderRadius: '10px', padding: '1.25rem', cursor: 'pointer', transition: 'all 0.2s'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <div>
                                                    <h3 style={{fontSize: '1.375rem', fontWeight: 700, color: '#f9fafb'}}>{deck.name}</h3>
                                                    <p style={{color: '#6b7280', fontSize: '0.75rem'}}>{new Date(deck.createdAt).toLocaleDateString()}</p>
                                                </div>
                                                <button onClick={e => { e.stopPropagation(); if(confirm('Delete?')) { setDecks(decks.filter(d => d.id !== deck.id)); setSelectedDeck(null); }}} style={{padding: '0.625rem 1.25rem', background: '#404040', color: '#f9fafb', border: 'none', borderRadius: '8px', cursor: 'pointer'}}>Delete</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                    
                    {activeTab === 'view' && selectedDeck && (
                        <div className="card">
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '1.5rem'}}>
                                <h2 style={{fontSize: '1.75rem', fontWeight: 700, color: '#f9fafb'}}>{selectedDeck.name}</h2>
                                <button onClick={() => setActiveTab('library')} style={{padding: '0.625rem 1.25rem', background: '#2d2d2d', color: '#d1d5db', border: 'none', borderRadius: '8px', cursor: 'pointer'}}>‚Üê Back</button>
                            </div>
                            <div style={{marginBottom: '2rem'}}>
                                <h3 style={{fontSize: '1.25rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1rem'}}>Deck List</h3>
                                <pre style={{background: '#0a0a0a', borderRadius: '8px', padding: '1.5rem', fontFamily: 'monospace', fontSize: '0.875rem', whiteSpace: 'pre-wrap', color: '#d1d5db', border: '1px solid #404040'}}>{selectedDeck.deckList}</pre>
                            </div>
                            <div>
                                <h3 style={{fontSize: '1.25rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1rem'}}>ü§ñ AI Strategic Analysis</h3>
                                <div className="analysis" dangerouslySetInnerHTML={{ __html: marked.parse(selectedDeck.analysis) }} />
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'settings' && (
                        <div className="card">
                            <h2 style={{fontSize: '1.75rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1.5rem'}}>Settings</h2>
                            
                            <div className="api-key-section">
                                <h3 style={{fontSize: '1.25rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1rem'}}>ü§ñ AI Setup</h3>
                                <p style={{color: '#d1d5db', marginBottom: '1rem', lineHeight: 1.6}}>
                                    Add your Anthropic API key for AI strategic analysis.
                                </p>
                                <p style={{color: '#93c5fd', marginBottom: '1rem', fontSize: '0.875rem'}}>
                                    Get API key: <a href="https://console.anthropic.com/" target="_blank" style={{color: '#dbeafe', textDecoration: 'underline'}}>console.anthropic.com</a>
                                    <br/>Cost: ~$0.03-0.05 per analysis
                                </p>
                                {apiKey ? (
                                    <div className="alert alert-success">
                                        ‚úÖ API Key configured!
                                        <button onClick={clearApiKey} style={{marginTop: '0.75rem', padding: '0.5rem 1rem', background: '#404040', color: '#f9fafb', border: 'none', borderRadius: '6px', cursor: 'pointer', display: 'block'}}>
                                            Remove Key
                                        </button>
                                    </div>
                                ) : (
                                    <div>
                                        <input type="password" className="input" value={apiKeyInput} onChange={e => setApiKeyInput(e.target.value)} placeholder="sk-ant-..." style={{marginBottom: '0.75rem'}} />
                                        <button onClick={saveApiKey} disabled={!apiKeyInput.trim()} className="btn btn-success">Save API Key</button>
                                    </div>
                                )}
                            </div>
                            
                            <h3 style={{fontSize: '1.25rem', fontWeight: 700, color: '#f9fafb', marginBottom: '1rem'}}>üì¶ Card Sets</h3>
                            <p style={{marginBottom: '1rem', color: '#d1d5db'}}>{availableSets.length} sets available</p>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '0.5rem', maxHeight: '400px', overflow: 'auto', padding: '0.5rem', background: '#0a0a0a', borderRadius: '8px', marginBottom: '1.5rem', border: '1px solid #404040'}}>
                                {availableSets.map(set => (
                                    <label key={set.id} style={{display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.75rem', background: '#1a1a1a', border: '1px solid #404040', borderRadius: '6px', cursor: 'pointer'}}>
                                        <input type="checkbox" checked={selectedSets.includes(set.id)} onChange={e => setSelectedSets(e.target.checked ? [...selectedSets, set.id] : selectedSets.filter(id => id !== set.id))} style={{width: '1.125rem', height: '1.125rem'}} />
                                        <span style={{fontSize: '0.875rem', fontWeight: 600, color: '#d1d5db'}}>{set.name || set.id}</span>
                                        {loadedSets.includes(set.id) && <span style={{color: '#93c5fd', fontSize: '0.75rem', marginLeft: 'auto'}}>‚úì</span>}
                                    </label>
                                ))}
                            </div>
                            <button className="btn btn-primary" onClick={loadSets} disabled={isLoadingSets || selectedSets.length === 0}>
                                {isLoadingSets ? `Loading (${loadedSets.length}/${selectedSets.length})...` : `Load ${selectedSets.length} Sets`}
                            </button>
                        </div>
                    )}
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
